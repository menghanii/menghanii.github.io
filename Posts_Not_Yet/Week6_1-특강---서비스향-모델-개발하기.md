---
title: Week6_1 특강 - 서비스향 AI 모델 개발하기
categories: [boostcamp]
tags: [부스트캠프, 특강]
math: true
comments: true
---

\- 이 강의정리본은 UPSTAGE AI CTO 이활석님의 강의를 정리한 것임을 밝힙니다.\- 

### 서비스향 AI 모델 개발

- 일반적으로 수업에서는 `학습 데이터셋`과 `테스트 데이터셋`이 주어지고, 모델의 성능을 높이는 작업을 주로 한다.
- 그런데 보통 서비스업에서 AI모델을 개발할 때는, 학습데이터셋도, 테스트데이터셋도 없는 경우가 많다.
- 단, 서비스 요구사항이 있다.
- 서비스 요구사항으로부터 학습데이터셋의 종류/수량/정답을 정해야 한다.
  - "수식을 사진으로 찍어서 인식하는 기술을 개발해주세요"라는 서비스 요구사항이 전달되었다고 하자.
  - 질의응답을 통해 학습데이터셋을 구체화해야한다.
  - "어떤 수식을 말씀하시나요?" 
  - "초중고 수학으로 생각하고 있습니다." → 학습 데이터셋의 `종류`에 대한 정보가 됨. 초/중/고 수식
  - "구체적으로 어떻게 사용하실 계획인가요?"
  - "학생들이 수식 입력하는 것을 힘들어하는 것 같아서, AI가 대신해주면 어떨까 해서요." → 학습 데이터셋의 `정답`에 대한 정보가 된다. `LaTex String`
  - 이미지를 찾아보다가, "손으로 쓴 수식도 인식해야 하나요?"
  - "손글씨 수식도 인식해야 합니다." → `종류`에 대한 구체화. 초중고 수식뿐 아니라, 손글씨도!
  - 이미지를 찾다보니, `그림자`, `형광펜`, `잘린 부분`, `화이트`, `회전`, `종이 구겨짐` 등의 모든 상황에 대해서도 대응해야 한다. 

### 학습 데이터셋 준비 : 종류/수량

- 어디까지를 '종류'로 정의해서 각각 몇 장을 수집할 것인지 정해야 한다.
  - `프린트` / `손글씨` * `초/중/고`로 구분해서 6개의 카테고리로 나누는 안도 있고,
  - `깨끗/그림자/회전` * `초/중/고`로 구분해서 9개의 카테고리로 나눌 수도 있다.

### 학습 데이터셋 준비 : 기술 모듈 설계

- 직접 데이터를 모으다 보면 생각하지 못한 경우를 마주하게 된다.
- 예를 들어, 하나의 이미지 안에 수식이 여러개 나오는 경우가 존재한다.
- 따라서, `수식 영역 검출기`가 추가적으로 필요해지게 된다.

### 학습 데이터셋 준비 : 정답

- 정답 : AI 모델 별로 입력에 대한 출력 쌍
- ① 수식 영역의 위치는 다양한 방법으로 표현할 수 있다.
  - 점 2개, 점 2개 + 각도, 점 4개, 픽셀 영역
- ② 이렇게 수식 영역의 위치를 잡아서 수식 이미지 하나가 잡혔다면, 이에 대해 LaTex String을 만들어내야한다.
  - Image To LaTex가 하나의 모델로 가능할까?
  - `검출기`→`인식기`→`정렬기`→`변환기` 의 4가지 모델 조합은 어떨까?
  - 검출기 : LaTex 심볼 검출
  - 인식기 : LaTex 심볼 분류
  - 정렬기 : LaTex 들을 한 줄로 정렬
  - 변환기 : LaTex String 생성

### 학습 데이터셋 담당자라면..

- 서비스 기획자와 논의
  - 기능 요구사항 구체화
  - 학습 데이터의 수량/종류 논의
- AI 모델 개발자와 논의
  - AI 모델 설계 논의
  - 학습 데이터 정답/수량/종류 논의
- 외주업체와의 미팅
  - 작업 툴 개발
  - 작업 가이드 작성(★)
  - 작업 단가/수량 논의
  - QnA 대응

### 테스트 데이터셋/테스트 방법

- 서비스 요구사항으로부터 테스트 데이터셋/방법을 준비해야한다.

- `1 vs 1` 대전을 하는 AI모델을 만든다고 해보자.

  - 입력 = 게임화면 이미지(100ms마다 한 이미지)
  - 출력 = 스킬셋+ no_action 중 하나 선택
  - 프로게이머들의 로그를 받아서 이미지별로 어떤 스킬을 썼는지 AI를 학습시킴.
  - 분류 정확도가 무려 99%가 나왔다고 하자.
  - 그럼 실제 사용자와 AI가 붙었을 때 어떻게 되었을까?
  - 완패
  - 왜냐면 AI는 아무런 스킬을 사용하지 않았기 때문이다.
    - 프로게이머들의 로그 : no action이 대부분, 스킬은 적재적소에만 사용했다.
    - 따라서, 모델은 거의 항상 no_action을 선택하게 되고, 분류정확도는 99%가 나오지만 실제 승률은 0%가 됨.

- 즉, 실서비스 적용 전 개발환경(ONLINE)에서의 정량평가와, 실서비스 적용시(OFFLINE)의 정량평가는 이질감이 굉장히 클 수 있다.

- 따라서, ONLINE TEST 결과와 유사하게 OFFLINE 테스트를 잘 설계해야한다.

- |          | OFFLINE                                                   | ONLINE                                            |
  | -------- | --------------------------------------------------------- | ------------------------------------------------- |
  | 정량평가 | 완벽하지 않기 때문에 AI 모델 후보 선택 목적으로 활용      | 해당 AI 모델을 서비스 시나리오에서 자동정량평가   |
  | 정성평가 | 각 후보 AI 모델에 대한 면밀 분석 후 서비스 출시 버전 선택 | VOC(Voice of Customer) : AI 모델 개선 포인트 파악 |

### 처리시간/목표 정확도

- 처리시간은 하나의 입력이 처리되어 출력이 나올 때까지의 시간.
  - OFFLINE : 이미지 입력 - 수식영역정보가 출력될 때까지의 시간
  - ONLINE : 이미지 촬영 - 수식 영역 정보가 화면상에 표현될 때까지의 시간
- 목표 정확도 : 해당 기술 모듈들의 정량적인 정확도
  - 신용카드 인식의 경우
  - OFFLINE : 입력된 이미지 내 카드번호/유효기간에 대한 EDIT DISTANCE
  - ONLINE : 사용자가 AI 모델의 결과값을 수정할 확률

### 목표 qps

- QPS : Queries Per Second , 1초당 처리 가능한 요청 수
- 높을수록 좋다.
- 향상시키는 방법
  - 장비를 늘린다. → N대 늘리면 QPS도 N배 올라간다.
  - 처리시간을 줄인다. → AI모델 처리 속도가 N배 올라가면 QPS도 N배 올라간다.
  - 모델 크기를 줄인다. → 한 GPU에 올라가는 모델 수가 N배가 되면, QPS도 N배 올라간다.
    - 만약 GPU가 10GB이고, 기존 모델이 8GB였다면, 5GB가 될 때까지는 모델을 2개 올릴 수 없으므로 6GB든 7GB든 똑같다.

### Serving 방식 / 장비 사양

- Serving 방식 : 기술 모듈이 Mobile에서 동작하길 원하는지, Local CPU/GPU Server에서 동작하기 원하는지, Cloud CPU/GPU Server에서 동작하기 원하는지
- 장비사양 : 가끔 Serving 장비조차 없어서 장비 구축까지 같이 요구하는 경우도 있다.

### AI 모델  개발 기술팀의 조직구성

- AI 모델 개발에는 수업에서 익히는 것 외에 정말 많은 일들이 존재한다.
- 그럼 이걸 혼자하느냐? 그렇지 않다. 많은 사람들이 일을 나누어서 한다.
- 그럼 서비스향 AI 모델 개발 기술팀의 조직구성을 알아보자.
  - ① AI 모델팀 : AI 모델을 개발하는 인력(모델러)
  - ② Data Curator : 데이터를 준비하고 품질을 관리하는 인력 → 학습 데이터 준비, 정량평가/정성평가
  - ③ IDE Developer : 라벨링 툴 개발, 모델분석 툴(for debugging) 개발, 모델 개발 자동화 파이프라인 개발
  - ④ 전체 총괄하여 모델 품질을 관리하는 사람 필요.
  - 여기까지의 인력을 통해 만들어지는 최종 결과물은 하나의 `Model`로, pytorch 혹은 tensorflow 모델 등을 의미한다.
- 그런데, AI 모델 Serving까지 요구되면 필요한 인력은 늘어난다.
  - Model Engineer , 이들은 무슨 일을 하는가?
  - ex) Mobile에서 구동하기 위해, `Pytorch` → `TensorFlow` → `TFLite`로 변환
  - ex) GPU 서버에서 구동하기 위해, `Pytorch` → `TensorFlow` → `TensorRT`로 변환
  - Toolkit(TFLite, TensorRT 등)에서 지원되는 operation으로만 모델 구조를 변경하여 재학습 or Custom Layer 구현
  - 메모리를 줄이기 위한 LightWeight(경량화) 작업
  - GPU 고속처리를 위한 CUDA Programming
  - 모든 연산을 C++/C 등으로 변환
- 마지막으로 모델을 실제 서빙하기 위한 추가 작업들이 end-device에 맞춰서 더 있다.
  - `App`이라면 `App Developer`가 필요 → 이 안에서도 다시 `Android`인지, `ios`인지에 따라 나뉨.
  - `BackEnd`라면 API serving을 위해 여러 작업이 또 필요함.

### AI쪽으로 커리어를 쌓고자하는 분들에게 - 당부의 말씀

- Model Engineering, Tool, Serving은 개발력이 많이 필요한 일이고, 앞으로 점차 니즈가 많아질 것 → 너무 AI 모델링 쪽으로 한번에 넘어가지 말라. 중간에 있는 업무들을 경험하면서 점차적으로 넘어오는 것이 좋다. 
- 모델러 : 한 분야의 모델링에 대한 전문성도 중요하지만, 점점 해당 업무는 자동화되고(AutoML, 관련 툴) 관련 인력 수도 늘어나니 주변으로 역량을 확대하라!
  - ex. CV -> NLP, 경량화
  - ex. FrontEnd 개발 능력 확장 - annotation tool, debugging tool 
  - ex. BackEnd 개발 능력 확장 - api serving, massive gpu training
- 특히나, AI 기술 트렌드에 민감해야 한다.
  - AI 기술 발전속도는 다른 기술에 비해 훨씬 빠르고 변화무쌍하다.
  - 이를 당연히 받아들이고, 어떻게 하면 효율적으로 변화에 적응할지 고민해야 한다.