---
title: Week5_1 Graph - 실제 그래프는 어떻게 생겼을까?
categories: [boostcamp]
tags: [부스트캠프, NLP]
math: true
comments: true

---

\- 이 강의정리본은 KAIST 신기정 교수님의 강의를 정리한 것임을 밝힙니다.\- 

### 실제 그래프 vs 랜덤 그래프

- 실제 그래프(Real Graph) : 다양한 복잡계로부터 얻어진 그래프를 의미함.

  - 본 수업에서는 MSN 메신저 그래프를 예시로 사용함.
  - MSN 메신저 : 1억8천만 개의 정점, 13억 간선으로 이루어져 있음.

- 랜덤 그래프(Random Graph) : 실제그래프의 비교 대상. 확률적 과정을 통해 생성한 그래프를 의미함. 

  - 에르되스-레니 랜덤 그래프

    - 임의의 두 정점 사이에 간선이 존재하는지 여부는 동일한 확률 분포에 의해 결정된다.
    - $$G(n,p)$$로 표현할 수 있다.
    - n개의 정점을 가진다.
    - 임의의 두 개의 정점 간 간선이 존재할 확률은 p이다.
    - 정점 간의 연결은 서로 독립적이다.

  - $$G(3, 0.3)$$에 의해 생성될 수 있는 그래프와 각각의 확률은?

    -  ![image-20210222174229858](/assets/img/post-images/image-20210222174229858.png){: width="80%"}

    

### 작은 세상 효과

#### 필수 개념: 경로, 거리 및 지름

- 경로(path) : $$u$$와 $$v$$ 사이의 경로는 아래의 조건을 만족하는 정점들의 순열이다.
  - $$u$$에서 시작해서 $$v$$에서 끝난다.
  - 순열에서 연속된 정점은 간선으로 연결되어 있어야 한다.
  - ![image-20210222174555566](/assets/img/post-images/image-20210222174555566.png){: width="80%"}
    - 세 순열 모두 1에서 시작해서 8로 끝난다.
    -  마지막 예시에서, `4`번 정점이 두 번 등장 -> 순열에 같은 정점이 여러번 등장하더라도 경로임에는 변화가 없다.
    - `1, 6, 8`, `1, 3, 4, 5, 6, 8` 은 모두 1번 조건을 만족하나 2번 조건을 만족하지 못해  경로가 아닌 순열의 예시이다. 
  - 경로의 길이 : 해당 경로 상에 놓이는 간선의 수로 정의됨.
    - `1, 4, 6, 8` : 3
    - `1, 4, 3, 4, 6, 8` : 5
    - 즉, 정점의 개수 - 1 개로 정의됨.
- 거리(distance) : $$u$$와 $$v$$ 사이의 최단 경로의 길이
  - `1, 4, 6, 8` : `1`과 `8` 사이의 최단 경로는 `1, 4, 6, 8`이므로 경로의 길이는 `3`이고, 따라서 거리는 `3`
- 지름(Diameter) : 정점 간 거리의 최댓값
  - 그래프에 존재하는 모든 정점들의 쌍에 대해 거리를 계산하고, 그 중에 가장 큰 값이 그래프의 지름이 된다.
  - 위의 사례에서는 `2`와 `8` 사이의 최단경로 거리인 `4`가 가장 큰 값이므로 그래프의 지름이 `4`

#### 작은 세상 효과

- 임의의 두 사람을 골랐을 때, 몇 단계의 지인을 거쳐 연결되어 있을까?

- '여섯 단계 분리 실험'  by Stanley Milgram (1960s) : 오마하/위치타의 500인에게, 보스턴에 사는 한 사람에게 편지를 전달하게끔 하는 실험. 단, 지인에게 전달하는 방법을 통해서만 가능함.

  - 몇 단계의 지인을 거쳤을까? 25%만 전달되었지만, 평균적으로 `6`단계만을 거쳤다.
  - MSN 메신저 그래프에서는 어떨까? 정점 간 평균 거리가 `7` 정도밖에 되지 않음. (단, 거대 연결 구조만 고려함.)

- 이러한 현상을 가리켜 '작은 세상 효과'라고 한다. ('사돈의 팔촌'인 셈) 

- 작은 세상 효과는 높은 확률로 랜덤 그래프에도 존재한다.

  - 모든 사람에게 100명의 지인이 있다고 가정해보자.
  - 다섯 단계만 거쳐도 최대 100억(=100의 5승)명과 연결될 수 있다.

- 그러나 모든 그래프에 작은 세상 효과가 존재하는 것은 아니다.

  - 체인, 사이클, 격자 그래프에서는 작은 세상 효과가 존재하지 않는다.
  -  ![image-20210222190539843](/assets/img/post-images/image-20210222190539843.png){: width="80%"}
  - 여기서 특정 정점 간의 거리는 그래프가 커질수록 멀어지게 된다.

  

### 연결성의 두터운 꼬리 분포

#### 연결성?

- 연결성(Degree): 그 정점과 연결된 **간선의 수**
  - 정점 v의 연결성은 해당 정점들의 이웃의 수와 같다.
  - $$d(v)$$, $$d_v$$ 혹은 $$\|N(v)\|$$ 로 나타냄.
  - ![image-20210222190708926](/assets/img/post-images/image-20210222190708926.png){: width="80%"}
  - 방향성이 있는 그래프에서는 나가는 연결성과 들어오는 연결성을 구분한다.
  - 나가는 연결성은 $$d_{out}(v)$$ 혹은 $$\|N_{out}(v)\|$$, 들어오는 연결성은 $$d_{in}(v)$$ 혹은 $$\|N_{in}(v)\|$$로 표시함.
  - ![image-20210222190913523](/assets/img/post-images/image-20210222190913523.png){: width="80%"}

#### 실제 그래프의 연결성 분포 - 두터운 꼬리(Heavy Tail)

- 연결성이 매우 높은 허브(Hub) 정점이 존재하는 것을 의미함.
- ![image-20210222191125695](/assets/img/post-images/image-20210222191125695.png){: width="80%"}
- ex. 일반적인 사람의 팔로워 수는 적다. (왼쪽 화살표) 그러나 극단적인 outlier로서 방탄소년단의 팔로워 수는 21.8M 이나 된다.(오른쪽 화살표) 매우 연결성이 높음을 알 수 있다.
- But 랜덤그래프의 연결성 분포는 높은 확률로 **정규분포**와 유사하다.
- ![image-20210222191201845](/assets/img/post-images/image-20210222191201845.png){: width="80%"}
- 보게 되면 꼬리 쪽 분포가 거의 없는 것을 볼 수 있다.
- ![image-20210222191314158](/assets/img/post-images/image-20210222191314158.png){: width="80%"}
- 위와 같이, 실제 그래프에서는 좌하단의 Hub 정점이 있는 것을 볼 수있고, 왼쪽의 랜덤그래프에서는 Hub 정점이 없다.

### 거대 연결 요소

#### 연결 요소? (Connected Component)

- 다음 조건들을 만족하는 정점들의 집합을 의미함.
  - (1)연결 요소에 속하는 정점들은 경로로 연결될 수 있다.
    - 즉, 하나의 연결 요소에 있는 임의의 두 정점을 골랐을 때, 이 둘은 경로로 연결될 수 있다. 
  - (2) (1)의 조건을 만족하면서 정점을 추가할 수 없다.
- ![image-20210222191508547](/assets/img/post-images/image-20210222191508547.png){: width="80%"}
-  cf) `{1, 2, 3, 4}`는 `{5}`를 추가하더라도 여전히 (1)번 조건을 만족할 수 있기 때문에 연결 요소가 될 수 없다. `{6, 7, 8, 9}`는 (1)번 조건을 만족할 수 없으므로 연결 요소가 될 수 없다.

#### 거대 연결 요소 ? (Giant Connected Component)

- 실제 그래프에는 `거대 연결 요소`가 존재한다. 
- 거대 연결 요소는 대다수의 정점을 포함한다.
- ![image-20210222191813067](/assets/img/post-images/image-20210222191813067.png){: width="80%"}
- 하나의 거대 연결요소가 존재하는 것을 볼 수 있다.
- 랜덤 그래프에도 높은 확률로 거대 연결 요소가 존재한다. (단, 정점들의 평균 연결성이 1보다 충분히 커야한다.)
- ![image-20210222191943063](/assets/img/post-images/image-20210222191943063.png){: width="80%"}
- 평균 연결성이 커질수록 거대 연결요소가 대부분의 정점을 포함하는 것을 확인할 수 있다.

### 군집 구조

#### 군집구조와 군집계수

- 군집(Community) : 다음의 조건들을 만족하는 정점 집합
  - 집합에 속하는 정점 사이에 많은 간선이 존재함.
  - 집합에 속하는 정점과 그렇지 않은 정점 사이에 적은 수의 간선이 존재함.
  - But 수학적으로 엄밀한 정의는 아니다.
  - ![image-20210222192139384](/assets/img/post-images/image-20210222192139384.png){: width="80%"}
  - 위의 예시 그래프에는 `11`개의 군집이 있는 것으로 보임. 
- 지역적 군집계수(Local Clustering Coefficient) : 한 정점에서 군집의 형성 정도를 측정하기 위해 사용하는 계수.
  - 정점 `i`의 지역적 군집계수 = 정점 `i`의 이웃 쌍 중 간선으로 직접 연결된 것의 비율. $$C_i$$로 표현한다.
    - ![image-20210222192313807](/assets/img/post-images/image-20210222192313807.png){: width="80%"}
    - 정점 `1`의 이웃은 4개이며, `(2, 3), (2, 4), (2, 5), (3, 4), (3, 5), (4, 5)`로 총 6개의 이웃쌍을 만들 수 있음.
    - 그 중 `(2, 3), (2, 4), (3, 5)`만이 간선으로 직접 연결되어 있다.
    - 따라서 $$C_1 = \frac{3}{6} = 0.5$$ 
  - ![image-20210222192457449](/assets/img/post-images/image-20210222192457449.png){: width="80%"}
  - 이웃쌍 사이의 간선 수가 많아질수록 지역적 군집계수가 높아지는 것을 확인할 수 있다.
  -  연결성이 0인 경우에는 지역적 군집계수가 정의될 수 없다.
- `지역적 군집계수`가 `군집`과 어떻게 연결될 수 있을까? 
  - 정점 `i`의 지역적 군집 계수가 매우 높다고 가정하자.
  - 이는 곧, 정점 `i`의 이웃들도 높은 확률로 서로 연결되어 있음을 의미한다.
  - 따라서 정점 `i`와 그 이웃들은 높은 확률로 `군집`을 형성한다.
- 전역 군집 계수(Global Clustering Coefficient) : 각 정점에서의 지역적 군집계수의 `평균`.(단, 지역적 군집계수가 정의되지 않는 정점은 제외함.)
- 실제 그래프에서는 군집계수가 높다. → 즉 많은 군집이 존재한다. 
  - 여러가지 이유가 있을 수 있다.
  - ① `동질성`(Homophily) : 서로 유사한 정점끼리는 간선으로 연결될 가능성이 높다. 예를 들어 친구 관계 그래프에서, 같은 인종의 사람들끼리 군집을 형성할 수 있다. 
  - ② `전이성`(Transitivity) : 공통 이웃이 있는 경우, 공통 이웃이 매개 역할을 해줄 수 있다. 친구를 서로에게 소개시켜주는 것이 예시이다.
- 반면, 랜덤 그래프에서는 지역적/전역 군집계수가 높지 않다.
  - $$G(n, p)$$에서 군집 계수는 $$p$$이다.
  - 랜덤 그래프에서의 간선 연결이 `독립`적인 것을 고려하면 당연한 결과임.
  - 즉, 공통 이웃의 존재 여부가 간선 연결 확률에 영향을 미치지 않기 때문!
  - `동질성`도 , `전이성`도 없다.

### 실습 : 군집 계수 및 지름 분석

#### 데이터 불러오기

![image-20210222193207846](/assets/img/post-images/image-20210222193207846.png){: width="80%"}

- `균일 그래프`에서는 각 정점이 4개의 다른 정점들과 연결되어 있다. 그 연결 양상도 균일한 패턴을 따르고 있다.
- `랜덤 그래프` : 에르도스-뢰니 그래프
- `작은 세상 그래프` 는 , 균일 그래프의 일부 간선을 임의로 선택한 간선으로 대체한 그래프. 여전히 4개의 다른 정점들과 연결되어 있는 것은 동일하다.

#### 지름 계산 (균일그래프/작은세상그래프/랜덤그래프를 불러왔음을 가정함.)

```python
def getGraphDiameter(Graph):
    diameter = 0
    for v in Graph.nodes:
        length = nx.single_source_shortest_path_length(Graph, v) # 그래프와 출발 정점을 인자로 받아 다른 정점들과의 거리를 계산한 vecotor를 반환함.
        max_length = max(length.values()) # 길이가 가장 긴 path의 거리가 반환됨.
        if max_length > diameter:
            diameter = max_length
    return diameter

print("1. Graph Diameter")
print('regular graph: ' + str(getGraphDiameter(regular_graph)))
print('small_world graph: ' + str(getGraphDiameter(small_world_graph)))
print('random graph: ' + str(getGraphDiameter(random_graph)))
```



#### 군집 계수 계산

```python
# 지역 군집 계수의 평균
def getGraphAverageClusteringCoefficient(Graph):
    ccs = [] # 지역 군집 계수를 추가할 리스트
    for v in Graph.nodes: # 각 정점 별로
        num_connected_pairs = 0
        for neighbor1 in Graph.neighbors(v):
            for neighbor2 in Graph.neighbors(v):
                if neighbor1 <= neighbor2:
                    continue
                if Graph.has_edge(neighbor1, neighbor2):
                    num_connected_pairs += 1
        cc = num_connected_pairs / (Graph.degree(v) * (Graph.degree(v) - 1) / 2) 
        # 실제로 간선으로 직접 연결된 이웃들의 수 / v 정점의 이웃들의 쌍의 수
        ccs.append(cc)
    return sum(ccs)/len(ccs)

print("2. Average Clustering Coefficient")
print('regular graph: ' + str(getGraphAverageClusteringCoefficient(regular_graph)))
print('small_world graph: ' + str(getGraphAverageClusteringCoefficient(small_world_graph)))
print('random graph: ' + str(getGraphAverageClusteringCoefficient(random_graph)))
```



#### 비교

![image-20210222200016788](/assets/img/post-images/image-20210222200016788.png){: width="80%"}

### 정리

1. 실제그래프 vs 랜덤그래프 : 실제 그래프는 복잡계로부터 얻어지는 반면, 랜덤 그래프는 확률적 과정을 통해 생성된다.
2. 작은 세상 효과 : 실제 그래프의 정점들은 가깝게 연결되어 있다.
3. 연결성의 두터운 꼬리 분포 : 실제 그래프에는 연결성이 매우 높은 허브 정점이 존재한다.
4. 거대 연결 요소 : 실제 그래프에는 대부분의 정점을 포함하는 거대 연결 요소가 존재한다.
5. 군집 구조 : 실제 그래프에는 군집이 존재하며, 실제 그래프는 군집 계수가 높다.



