---
title: Week5_3 그래프의 구조를 어떻게 분석할까?
categories: [boostcamp]
tags: [부스트캠프, Graph]
math: true
comments: true
---

\- 이 강의정리본은 KAIST 신기정 교수님의 강의를 정리한 것임을 밝힙니다.\- 

### 군집구조와 군집탐색문제

#### 군집의 정의

- 군집(Community) : 집합에 속하는 정점끼리는 많은 간선이 존재하나, 집합에 속하지 않은 정점과의 간선은 적다. 수학적으로 엄밀한 정의는 X.
- 온라인 소셜 네트워크의 군집들 : 사회적 무리, 즉 Social Circle을 의미하는 경우가 많다.
- 조직 내의 분란이 군집으로 표현될 수도 있다.
  - ex) 내분으로 동아리가 나뉘면서 해당 조직의 친구그래프를 만들어보니 두 개의 군집이 형성되었음.

#### 실제 그래프의 군집들

- `인접 행렬`로 표현해보면, `0`이 아닌 원소들이 밀집한 모양으로 군집이 형성되어있음.
- 키워드-광고주 그래프 : 여러 키워드에 광고주들이 밀집한 모양
- 뉴런 간 연결 그래프 : 군집 - 뇌의 특정 기능을 담당. 

#### 군집 탐색들

- 군집 탐색 문제(Community Detection) : 그래프를 여러 군집으로 잘 나누는 문제.

### 군집구조의 통계적 유의성과 군집성

- 성공적인 군집 탐색의 조건에 대해 알아보자.

#### 비교 대상 : 배치모형(Configuration Model)

![image-20210224100649941](/assets/img/post-images/image-20210224100649941.png)

- 각 정점들의 연결성(Degree)을 보존한 상태에서
- 간선들을 무작위로 재배치하여 얻은 그래프.
- 배치모형에서 임의의 두 정점 `i`와 `j` 사이에 간선이 존재할 확률은 두 정점의 연결성에 비례함.

#### 군집성(Modularity)의 정의

- 그래프와 군집 집합 `S`가 주어졌다고 가정하자. 

- 각 군집 `s`가 군집의 성질을 잘 만족하는지를 살펴보기 위해, 군집 내부 간선 수를 그래프와 배치모형에서 비교해보자.

- 군집성

  - $$
    \frac{1}{2|E|}\sum_{s\in{S}}(그래프에서\ 군집s\ 내부\ 간선\ 수\ -\ 배치모형에서\ 군집s\ 내부\ 간선\ 수의\ 기대값)
    $$

  - 즉, 배치모형과 비교해서, 그래프에서 군집 내부 간선 수가 월등히 많을수록 성공한 군집 탐색이다.

  - 항상 `-1`에서 `+1` 사이의 값을 갖는다.

  - 보통 군집성이 `0.3` ~ `0.7`정도의 값을 가질 때, 통계적으로 유의미한 군집들을 찾아냈다고 할 수 있다.

### 군집 탐색 알고리즘

#### Girvan-Newman 알고리즘

- 대표적인 `Top-Down` 군집 탐색 알고리즘.

- 전체 그래프에서 탐색을 시작하여, 군집들이 서로 분리되도록 간선을 순차적으로 `제거`함.

  - 어떤 간선을 제거해야 군집들이 분리될까?

  - `다리(Bridge)` 역할을 하는 간선들

  - ![image-20210224101440672](/assets/img/post-images/image-20210224101440672.png){: width="80%"}

  - 그럼 다리 역할의 간선들을 어떻게 찾아낼 수 있는가?

  - 이를 위해 G-N 알고리즘에서는 `매개중심성(Betweenness Centrality)`을 사용함.

  - 매개중심성 : 해당 간선이 정점 간의 최단 경로에 놓이는 횟수 

  - ![image-20210224101620807](/assets/img/post-images/image-20210224101620807.png){: width="80%"}

  - 위 예에서 가운데 간선은 총 `4 x 4`개의 정점 조합에서 최단 경로에 놓이지만, 오른쪽 간선은 단 하나의 정점 조합에서 최단 경로에 놓인다. 

  - 정점 `i`로부터 `j`로의 최단 경로 수를 $$\sigma_{i,j}$$라 하고, 그 중 간선 `(x, y)`를 포함한 것을 $$\sigma_{i,j}(x,y)$$라 하자. 이 때 간선 `(x, y)`의 매개중심성은

  - $$
    Betweenness Centrality_{(x,y)}=\sum_{i<j}\frac{\sigma_{i,j}(x,y)}{\sigma_{i,j}}
    $$

  - 로 나타낼 수 있다.

  - 실제 매개중심성이 `높은` 간선들이 서로 다른 군집들을 연결하는 다리 역할을 하는 것을 확인할 수 있다.

- G-N 알고리즘은 매개중심성이 높은 간선을 순차적으로 제거한다.

  - ![image-20210224102419955](/assets/img/post-images/image-20210224102419955.png){: width="80%"}

  - 간선이 제거될때마다, 매개중심성을 다시 계산하여 갱신한다.
  - 모든 간선이 제거될 때까지 반복한다!
  - 이 간선의 제거 iteration에 따라 다른 입도(Granularity)의 군집구조가 나타난다.
    - 처음에 `(7,8)`만 제거한 경우에는 `2`개의 군집구조가,
    - 그 다음으로 `(3, 7)`, `(6, 7)`, `(8,9)`, `(8,12)`를 제거한 경우에는 `6`개의 군집구조가 나타난다.  
  - 간선을 어느정도 제거해야 적합할까?
    - 군집성이 최대가 되는 지점까지 간선을 제거한다.
    - ![image-20210224102729007](/assets/img/post-images/image-20210224102729007.png){: width="80%"}
    - 단, 현재의 연결 요소들을 군집으로 가정하되, 입력 그래프에서 군집성을 계산한다.

- 요약

  - ① 전체 그래프에서 시작(Top-Down; 하향식)
  - ② 매개중심성이 높은 순서대로 간선을 제거하며, 군집성의 변화를 기록함
  - ③ 군집성이 가장 커지는 상황을 복원
  - ④ 이 때 서로 연결된 정점들(연결 요소)을 하나의 군집으로 간주

#### Louvain 알고리즘

- 대표적인 `Bottom-Up` 군집 탐색 알고리즘
- 개별 정점에서 시작해서 점점 큰 군집을 형성함. 이러한 군집형성과정을 하나의 `pass`라고 함.
  - 즉 `1st pass`, `2nd pass`를 거쳐 점점 더 큰 군집을 형성.
- 어떤 기준으로 군집을 합칠까? 
  - 얘도 `군집성`!
  - Louvain 알고리즘은 군집 크기 1인 개별 정점들부터 시작함.
  - ① 각 정점 `u`를 기존/새로운 군집으로 이동함. 이 때, 군집성이 최대화되도록 군집을 결정한다.
  - ② 더 이상 군집성이 증가하지 않을 때까지 반복한다.
  - ③ 각 군집을 하나의 정점으로 하는 군집 레벨 그래프를 얻은 뒤, ②를 반복.
- ![image-20210224103421654](/assets/img/post-images/image-20210224103421654.png){: width="80%"}
- 위 그래프의 정점들은 실제로 여러 정점들로 구성된 군집임.
  - 불어를 사용하는 사람들의 비율이 높을수록 녹색,
  - 독어를 사용하는 사람들의 비율이 높을수록 적색
  - 예외적으로 가운데 군집 하나는 두 언어를 모두 사용하는 사람들이 혼합되어있고, 다리 역할을 함.

### 중첩이 있는 군집 탐색

#### 중첩이 있는 군집구조

- 실제 그래프의 군집들은 `중첩`되어 있는 경우가 많다. 
- 왜냐하면 개인들은 여러 역할을 수행하고, 따라서 여러 군집에 속하게 되기 때문이다.
- ![image-20210224103632856](/assets/img/post-images/image-20210224103632856.png){: width="80%"}
- 그러나 앞서 배운 `G-N 알고리즘`, `Louvain 알고리즘`은 군집간 중첩이 없음을 가정한다.
- ![image-20210224103738333](/assets/img/post-images/image-20210224103738333.png)
- 즉, 한 개의 정점은 오로지 한 개의 군집에만 속한다고 가정한다.
- 중첩이 있는 군집은 어떻게 찾아낼 수 있을까?
- `중첩 군집 모형`을 가정함.

#### 중첩 군집 모형

- 각 정점은 여러 개의 군집에 속할 수 있다.
- 각 군집 `A`에 대하여, 같은 군집에 속하는 두 정점은 $$P_A$$ 확률로 간선으로 직접 연결된다.
- 두 정점이 여러 군집에 동시에 속할 경우 간선 연결 확률은 독립적이다.
  - ex) 두 정점이 군집 `A`와 `B`에 동시에 속할 경우, 두 정점이 간선으로 직접 연결될 확률은 $$1-(1-P_A)(1-P_B)$$이다.
- 어느 군집에도 함께 속하지 않는 두 정점은 낮은 확률 $$\epsilon$$로 직접 연결된다.
- 중첩 군집 모형이 주어지면, 주어진 그래프의 확률을 계산할 수 있다.
- 그래프의 확률은 다음 확률들의 곱이다.
  - 1) 그래프 각 간선의 두 정점이 직접 연결될 확률
  - 2) 그래프에서 직접 연결되지 않은 각 정점 쌍이 직접 연결되지 않을 확률
  - 통계 용어를 빌리면, 최우도 추정치(Maximum Likelihood Estimate)를 찾는 과정.
- 그러나, 중첩 군집 모형을 찾아내는 것은 어려운 일이다.
- 이를 해결하기 위해 완화된 중첩 군집 모형을 사용함.

#### 완화된 중첩 군집 모형

- 각 정점이 각 군집에 속해 있는 정도를 `실숫값`으로 표현한다.
- 기존 모형에서는 속하거나/ 속하지 않거나 둘 중 하나였지만, 이제 중간 상태를 표현할 수 있게 된 것.
- 이게 좀 더 현실적임.
  - 우리도 다양한 군집에 속해있지만, 어떤 군집에는 좀 더 각별하고, 다른 군집에는 거의 참여하지 않기도 하기 때문이다.
- ![image-20210224161929762](/assets/img/post-images/image-20210224161929762.png){: width="80%"}
- 위의 예에서, 완화된 군집모형은 정점들이 군집에 연결된 정도를 선의 두께로 나타내고 있다.
- 왜 완화된 중첩 군집 모형이 더 용이하다는것일까?
  - 최적화 관점에서 생각해보아야 한다.
  - 모형의 매개변수들이 실숫값을 가지기 때문에, 우리가 사용할 수 있는 최적화 도구 (ex. 경사하강법)를 사용할 수 있기 때문이다.

### 실습: Girvan-Newman 알고리즘 구현 및 적용

### 정리

1. 군집 구조와 군집 탐색 문제
   1. 실제 그래프의 군집들은 무엇을 의미할까?
   2. 군집을 어떻게 찾아낼까?
2. 군집 구조의 통계적 유의성과 군집성
   1. `배치 모형`과의 비교를 통해 군집성을 측정
3. 군집 탐색 알고리즘
   1. 하향식 알고리즘 : `Girvan Newman` (전체그래프에서 간선을 제거해 나가는 방식)
   2. 상향식 알고리즘 : `Louvain`(개별 정점에서 시작해서 군집을 최대화)
4. 중첩이 있는 군집 탐색
   1. (완화된) 중첩 군집 모형 : `실숫값`으로 정점-군집의 연결 정도를 나타내어, `경사하강법` 등의 최적화 도구를 사용할 수 있게 함.
5. G-N 알고리즘 구현 및 적용

